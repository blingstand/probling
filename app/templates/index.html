<!DOCTYPE html>
<html lang="fr">
<head>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" Access-Control-Allow-Origin: * />
    <title>Application GrandPy Bot</title>
    <link rel="stylesheet" href="../static/css/style.css" />

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsqS4MLqsrTTmTkSCUNX97625NBJ4jXuI&language=fr">
    </script>
    <script src="../static/js/ajax.js"></script>
    <script src="../static/js/message.js"></script>
    <script src="../static/js/response.js"></script>
</head>
<body>
    <div class="chatbox">
        <div id="chatlogs"> <!-- ------------------------------ -->
            <div class="chatGPB">
                <div class="GPB-photo"></div>
                <p id="size" class="chat-message">Ah te voilà ! Que puis-je pour toi aujourd'hui ? Pose-moi une question ! </p>
            </div>


        </div><!-- --------------------------------------------- -->
    </div>
    <div class="chat-form">
            <input type="text" placeholder="ex : Est-ce que tu connais l'adresse ... ?" id="myInput" onkeypress="validate(event)" autofocus/>
            <div id="button">
                <button type="button" onclick="InteractionWithGPB()">Valider</button>
            </div>
    </div>
    <footer>
        <p>Adrien Clupot <a href="https://github.com/blingstand" target="_blank">lien github</a></p>
    </footer> <!-- ------------------------------------- -->
    <script type="text/javascript">
        //my var
        // let myQuestion = "as-tu des informations sur bordeaux ?";

        let message = new Message()
        //I need the url
        let url = document.location.href + "index/question";

        let validate = function(event){
            //starts a search when user push entry (keyCode = 13)
            if(event.keyCode == 13){
                InteractionWithGPB()
            }
        }
        //main =)
        let InteractionWithGPB = function(){
            //user asks a question
            let myQuestion = message.getMessage("myInput");
            message.question(myQuestion);
            let height = chatlogs.scrollHeight;
            setTimeout(function(){message.scrollDown(height)},1000);
            //grandPy thinks
            const ajaxRequest = new AjaxRequest();
            gPBMemory = ajaxRequest.getResponse(url, myQuestion);

            //grandPy answers if he can
            gPBMemory.then(function(resp){
                lastChatMessage = message.response();
                if (resp["is_response"] == 1){
                const responseGPB = new Response(resp);
                console.log(resp)
                responseGPB.greatMessage(lastChatMessage);
                }else{
                    lastChatMessage.textContent = "Désolé je ne connais pas cet endroit ... \nPeut-être pourrais-tu reformuler ou me poser une autre question ?"
                    let chatlogsSize = chatlogs.scrollHeight;
                    
                    message.scrollDown(chatlogsSize)

                }
            });
        }

    </script>

</body>
</html>

